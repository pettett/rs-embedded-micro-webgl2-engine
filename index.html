<!DOCTYPE html>
<html>

<head>
	<meta content="text/html;charset=utf-8" http-equiv="Content-Type" />

	<style>
		.canvas {
			width: 848px;
			height: 480px;
		}
	</style>

	<script src='/webgl_renderer.js'></script>

	<script type="module">
		import init, { WebClient } from './webgl_renderer.js';


		async function displayMesh(uri) {
			// just set the lua to display only the mesh

			document.getElementById('onload').value = `let data= [
	#{
		type:"water",
		reflectivity: 0.5,
		fresnel_strength: 1.5,
		wave_speed: 0.06,
		use_reflection: true,
		use_refraction: true,
	},
	#{
		type : "mesh",
		position : [0,0,0],
		mesh : "assets/models/` + uri + `",
		texture : "assets/textures/stone-texture.png",
		update : |ent|{
			ent.rotation[1] += 0.01;
		}
	}, 
]; 
return data;`

			restart()
		}


		async function restart() {
			document.getElementById('onloadout').innerText = await window.webClient.restart(document.getElementById('onload').value)
		}


		window.restart = restart;

		window.displayMesh = displayMesh;

		async function run() {




			await init();

			// Start our rust application. You can find `WebClient` in `src/lib.rs`
			const webClient = new WebClient()
			webClient.start()

			window.webClient = webClient



			let time = Date.now();
			function render() {
				const dt = Date.now() - time;

				webClient.update(dt);
				webClient.render();
				window.requestAnimationFrame(render);

				time = Date.now();
			}

			render()
		}

		run(); 
	</script>
</head>

<body>
	<select name="meshes" id="meshes" onchange="window.displayMesh(value)">
		<option value="Forklift.glb">Forklift</option>
		<option value="Drill.glb">Drill</option>
		<option value="Lantern.glb">Lantern</option>
		<option value="knifing_goose.glb">Goose</option>
		<option value="torus.glb">Torus</option>
		<option value="cube.glb">Cube</option>
	</select>


	<div id="webgl-water-tutorial"> </div>


	<textarea id="onload" rows="15" cols="63" style="outline: none;" autocorrect="off" autocapitalize="none" spellcheck="false" tabindex="0" wrap="off">
let data= [ 
	#{
		type : "mesh",
		position : [0,-3,0],
				scale: [0.04,0.04,0.04],
		mesh : "assets/models/Sponza.gltf",
		texture : "assets/textures/stone-texture.png",
	 
	}, 
]; 
return data;
	</textarea>
	<button onclick="window.restart()">Restart</button>
	<p id="onloadout"></p>

</body>

</html>